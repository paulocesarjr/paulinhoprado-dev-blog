---
title: Testes end-to-end e sua real utilidade
slug: testes-end-to-end-e-sua-real-utilidade
description: Implementar testes durante o desenvolvimento de um software √© sempre um assunto delicado. Apesar de serem apreciados por muitos e odiados por outros, a pr√°tica de testar √© uma garantia de funcionamento e qualidade.
date: 2024-04-17
lastUpdated: 2024-04-17
image: /images/testes-end-to-end-e-sua-real-utilidade/teste_cypress.gif
tags:
  - Testes
---

Implementar testes durante o desenvolvimento de um software √© sempre um assunto delicado. Apesar de serem apreciados por muitos e odiados por outros, a pr√°tica de testar √© uma garantia de funcionamento e qualidade. Al√©m disso, testes contribuem potencialmente para eventuais refatora√ß√µes no c√≥digo.

Neste artigo, busco questionar a necessidade de implementa√ß√µes de testes end-to-end (ponta a ponta) em sistemas reais e discutir os melhores casos para sua aplicabilidade.

## A verdade sobre o end-to-end

Recentemente, junto ao meu time de Player Web na Globo, discutimos a necessidade de incluirmos testes end-to-end ao nosso fluxo de desenvolvimento. Ap√≥s algumas pesquisas e a cria√ß√£o de uma _POC_ feita em [Cypress](https://www.cypress.io/), ficamos bem impressionados com as facilidades da ferramenta. 

Evoluindo as discuss√µes, chegamos √† pergunta mais relevante: _O que devemos testar?_ De fato, qualquer player de v√≠deo possui uma infinidade de cen√°rios que podem ser testados. Comportamentos simples como iniciar um v√≠deo, pausar, avan√ßar, retroceder podem ser bons casos para iniciar a cria√ß√£o de testes. Mas at√© que ponto essas funcionalidade s√≥ s√£o garantidas atrav√©s de testes ponta a ponta?

Eis que surge a verdade sobre o teste end-to-end: **_Eles nem sempre s√£o necess√°rios!_**

<div style={{ textAlign: 'center' }}>
  <img 
    src="/images/testes-end-to-end-e-sua-real-utilidade/piramide-dos-testes.png" 
    alt="Pir√¢mide dos testes" 
    style={{ maxWidth: '100%', height: 'auto' }}
  />
  <p style={{ fontStyle: 'italic', color: '#666' }}>
    üí° Pir√¢mide dos testes automatizados.
  </p>
</div>

Analisando a cl√°ssica Pir√¢mide dos Testes, podemos perceber que os testes end-to-end representam o custo mais alto de implementa√ß√£o e t√™m uma velocidade mais lenta de resposta. Considerando um cen√°rio empresarial, onde tempo e dinheiro s√£o recursos valiosos, √© evidente que esse tipo de teste deve ser evitado. No entanto, esse ainda n√£o √© o √∫nico motivo pelo qual chegamos √† conclus√£o de que o end-to-end nem sempre √© necess√°rio.

Voltando a base da pir√¢mide, encontramos os testes unit√°rios. Esses, por sua vez, exigem menos esfor√ßo e retornam uma valida√ß√£o mais r√°pida. Foi a√≠ que surgiu o ponto relevante dessa discuss√£o. Nosso player de v√≠deo possui uma cobertura consider√°vel de testes unit√°rios, muitos dos quais testam comportamentos que seriam plenamente aplic√°veis em testes end-to-end.

Dado esse cen√°rio, a decis√£o do nosso time foi priorizar a constru√ß√£o de testes de unidade em vez dos end-to-end. Mas ser√° que os testes unit√°rios testam tudo que precisamos?

## O dilema dos tipos de teste

Um bom exemplo para mostrar esse contraste entre os dois tipos de teste √© levarmos ao cen√°rio do Player de v√≠deo. Considere que devemos escrever um teste para garantir o funcionamento de assistir ao v√≠deo ao no Player: _Quando o usu√°rio clicar no bot√£o de play, o v√≠deo deve ser iniciado_.

Criando um teste end-to-end para esse caso utilizando Cypress, ter√≠amos algo nesse sentido:

<img 
  src="/images/testes-end-to-end-e-sua-real-utilidade/teste_cypress.gif" 
  alt="Teste E2E com Cypress" 
  style={{ maxWidth: '100%', display: 'block', margin: '0 auto' }}
/>

Agora, usando alguma biblioteca de teste unit√°rio como Jest ou Jasmine, por exemplo, essa seria a implementa√ß√£o do teste:

```javascript
it('video should start when play button is clicked', () => {
  const player = new Player('test.mp4')
  player.playButton.click()
  expect(player.isPlaying).toBe(true)
})
```

Note que os dois exemplos testam o mesmo comportamento. Obviamente, cada tipo de teste dentro dos seus limites. Enquanto o teste end-to-end valida o comportamento na aplica√ß√£o final, simulando a intera√ß√£o do usu√°rio, o teste de unidade valida o comportamento isolado do componente de play.

Se ambos os tipos de teste cumprem o objetivo esperado, podemos optar pela estrat√©gia que consome menos recursos da stack de desenvolvimento, o que nesse caso √© o teste de unidade.

Ent√£o os testes end-to-end s√£o descart√°veis para todos os sistemas? **A resposta √© n√£o!**

Vamos considerar um segundo cen√°rio para teste: _Garantir que pelo menos uma publicidade seja exibida antes do v√≠deo come√ßar_.

Seguindo a l√≥gica do menor recurso, √© poss√≠vel criar testes de unidade que simulem a exibi√ß√£o de an√∫ncios no Player de v√≠deo por meio de mocks. No entanto, essa decis√£o traz consigo um dilema: _Como garantir que a publicidade seja realmente exibida se ela parte de uma simula√ß√£o?_.

Esse √© um exemplo do limite que os testes unit√°rios n√£o ultrapassam e a oportunidade definitiva para a implementa√ß√£o de um teste end-to-end, que por sua vez, testa a aplica√ß√£o real, sem simula√ß√µes.

A partir dessa reflex√£o, destaco alguns pontos importantes sobre a utiliza√ß√£o desses tipos de teste:

- Se um comportamento pode ser validado atrav√©s de um teste unit√°rio, deve-se dar prefer√™ncia a esse tipo de teste em vez do teste end-to-end;
- Testes end-to-end s√£o √≥timos para evitar o uso de mocks e dados simulados;
- Para cen√°rios onde √© dif√≠cil simular ou que exigem a intera√ß√£o do usu√°rio diretamente, testes end-to-end s√£o a melhor op√ß√£o;
- Em determinados cen√°rios, um teste end-to-end pode garantir a mesma cobertura que um conjunto de testes de unidade e integra√ß√£o.

## Cypress pode me ajudar?

Entre as v√°rias ferramentas de testes automatizados do mercado, algumas consolidadas como o Selenium, o Cypress se destaca por atuar diretamente no navegador, permitindo intera√ß√£o direta com a DOM.

Para os sistemas que utilizam a stack JavaScript, a combina√ß√£o pode ser perfeita, uma vez que o framework n√£o exige instala√ß√µes complexas e muito menos automa√ß√µes externas para sua execu√ß√£o. Um dos pontos altos dessa ferramenta √© a capacidade de realizar testes em tempo real, proporcionando uma abordagem mais pr√°tica para identifica√ß√£o de falhas. Al√©m disso, ela conta com uma funcionalidade espec√≠fica de "time travel" de depura√ß√£o.

Como mencionado anteriormente, o cen√°rio de entrega de publicidade dentro do Player da Globo foi uma boa oportunidade para experimentar esse framework. Considerando a complexidade para a constru√ß√£o de um poss√≠vel teste de integra√ß√£o e a necessidade de validar a entrega por completo, o Cypress atendeu √†s expectativas.

<img src="/images/testes-end-to-end-e-sua-real-utilidade/teste_ad_e2e.webp" alt="Teste E2E com Cypress" style={{ maxWidth: "100%", display: "block", margin: "0 auto" }} />

Por outro lado, cen√°rios mais simples, como a valida√ß√£o de comportamento de componentes isolados, n√£o justificam sua utiliza√ß√£o, uma vez que podem ser facilmente testados com testes de unidade.
